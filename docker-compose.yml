services:
  neo4j:
    image: neo4j:latest
    container_name: neo4j-lightrag
    ports:
      - "7474:7474"  # HTTP
      - "7687:7687"  # Bolt
    environment:
      NEO4J_AUTH: neo4j/password
      NEO4J_apoc_export_allow__all__nodes: "true"
      NEO4J_apoc_import_file_enabled: "true"
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
    restart: unless-stopped

  # vllm:
  #   image: vllm/vllm-openai:v0.6.6
  #   container_name: vllm-server-llama3-8b
  #   ports:
  #     - "8000:8000"
  #   environment:
  #     # GPU settings
  #     - NVIDIA_VISIBLE_DEVICES=all
  #     # HuggingFace token for gated models
  #     - HUGGING_FACE_HUB_TOKEN=$HF_TOKEN
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: all
  #             capabilities: [gpu]
  #   command: 
  #     --model meta-llama/Meta-Llama-3-8B-Instruct
  #     --host 0.0.0.0
  #     --port 8000
  #     --max-model-len 8192
  #   volumes:
  #     # Cache HuggingFace models locally
  #     - ./model_cache:/root/.cache/huggingface
  #   restart: unless-stopped
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3
  #     start_period: 60s
      
  vllm-gemma:
    image: vllm/vllm-openai:v0.6.6
    container_name: vllm-server-gemma-2-2b-it
    ports:
      - "8001:8000"
    environment:
      # GPU settings
      - NVIDIA_VISIBLE_DEVICES=all
      # HuggingFace token for gated models
      - HUGGING_FACE_HUB_TOKEN=$HF_TOKEN
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    command: 
      --model Qwen/Qwen2-7B-Instruct-AWQ
      --quantization awq
      --host 0.0.0.0
      --port 8000
      --max-model-len 8192
    volumes:
      # Cache HuggingFace models locally
      - ./model_cache:/root/.cache/huggingface
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  neo4j_data:
  neo4j_logs:
